<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.community.repository.mapper.BoardMapper">

  <select id="selectAll" resultType="board">
    select * from tb_board 
    order by no desc
  </select>
  
  <select id="selectAllCount" parameterType="board" resultType="int">
     select count(*) 
     from tb_board
     <if test='search != null'>
     where
      <choose>            
            <when test='search == "all"'>
                title like  concat('%',#{word},'%')
                or content like concat('%',#{word},'%')                
                or writer like concat('%',#{word},'%')               
            </when>
            <otherwise>
                ${search} like concat('%',#{word},'%')  
            </otherwise>
        </choose>
        </if> 
  </select>
  
  <select id="selectAllPaging" parameterType="board" resultType="board">
          SELECT T.* FROM
        (
            SELECT * FROM  tb_board
       <if test='search != null'>
            where
       	 <choose>           
            <when test='search == "all"'>
                title like  concat('%',#{word},'%')
                or content like concat('%',#{word},'%')                
                or writer like concat('%',#{word},'%')            
            </when>
            <otherwise>
                ${search} like concat('%',#{word},'%')  
            </otherwise>
         </choose>
            order by no asc
       </if>
        ) T
        LIMIT 10 OFFSET #{begin}
  </select>
  
  <insert id="writeBoard" parameterType="board">
    insert into tb_board(title,content,writer,view_cnt,create_date) 
    values(#{title},#{content},#{writer},0,sysdate())
  </insert>
  
  <select id="selectDatil" parameterType="int" resultType="board">
    select * from tb_board
    where no = #{no}
  </select>
  
  <update id="detailViewCnt" parameterType="int">
    update tb_board
      set view_cnt = view_cnt + 1
    where no = #{no}
  </update>
  
  <update id="updateBoard" parameterType="board">
    update tb_board
    set title = #{title},
        content = #{content}
    where no = #{no}    
  </update>
  
  <delete id="deleteBoard" parameterType="int">
    delete from tb_board
    where no = #{no}
  </delete>
  
</mapper>